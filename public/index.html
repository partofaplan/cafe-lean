<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Lean Coffee</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; padding: 24px; background: #0b1020; color: #f2f5ff; }
      .container { max-width: 900px; margin: 0 auto; }
      h1 { margin-top: 0; }
      .card { background: #131a33; border: 1px solid #253160; border-radius: 12px; padding: 16px; margin: 16px 0; }
      input[type="text"], button { font-size: 16px; padding: 10px 12px; border-radius: 8px; border: 1px solid #33407a; background: #0f1630; color: #fff; }
      button { cursor: pointer; background: #3b82f6; border-color: #3b82f6; }
      button.secondary { background: #0f1630; }
      .row { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
      .muted { color: #a3b0d4; font-size: 14px; }
      .links a { color: #93c5fd; text-decoration: none; }
      .links a:hover { text-decoration: underline; }
      code { background: #0f1630; padding: 4px 6px; border-radius: 6px; }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Lean Coffee</h1>
      <div class="card">
        <h2>Create a meeting</h2>
        <p class="muted">Creates a code, admin link, and join link.</p>
        <button id="createBtn">Create</button>
        <div id="createResult" class="muted" style="margin-top:12px;"></div>
      </div>
      <div class="card">
        <h2>Join a meeting</h2>
        <div class="row">
          <input id="joinCode" type="text" placeholder="Enter meeting code (e.g. 7G3XQK)" />
          <button id="joinBoard">Open Board</button>
          <button id="joinAsParticipant" class="secondary">Join as Participant</button>
        </div>
      </div>
      <p class="muted">Tip: Open the board on a TV or shared screen. Use the admin link on your phone to move topics. Participants open the join link to submit topics and vote.</p>
    </div>

    <script>
      const createBtn = document.getElementById('createBtn');
      const createResult = document.getElementById('createResult');
      createBtn.addEventListener('click', async () => {
        createBtn.disabled = true;
        try {
          const res = await fetch('/api/create', { method: 'POST' });
          const data = await res.json();
          // Save admin token locally so admin page can auto-auth
          try { localStorage.setItem(`adminToken:${data.meetingId}`, data.adminToken); } catch {}
          createResult.innerHTML = `
            <div>Meeting Code: <code>${data.meetingId}</code></div>
            <div class="links">
              <div>Board: <a href="${data.boardUrl}" target="_blank">${location.origin + data.boardUrl}</a></div>
              <div>Admin: <a href="${data.adminUrl}" target="_blank">${location.origin + data.adminUrl}</a></div>
              <div>Join: <a href="${data.joinUrl}" target="_blank">${location.origin + data.joinUrl}</a></div>
            </div>
          `;
        } catch (e) {
          createResult.textContent = 'Failed to create meeting.';
        } finally {
          createBtn.disabled = false;
        }
      });

      const joinCode = document.getElementById('joinCode');
      function normalized() { return (joinCode.value || '').trim().toUpperCase(); }
      document.getElementById('joinBoard').addEventListener('click', () => {
        const code = normalized(); if (!code) return;
        location.href = `/board/${code}`;
      });
      document.getElementById('joinAsParticipant').addEventListener('click', () => {
        const code = normalized(); if (!code) return;
        location.href = `/join/${code}`;
      });
    </script>
  </body>
  </html>

