<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Lean Coffee</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; padding: 24px; background: #0b1020; color: #f2f5ff; }
      .container { max-width: 900px; margin: 0 auto; }
      h1 { margin-top: 0; }
      .card { background: #131a33; border: 1px solid #253160; border-radius: 12px; padding: 16px; margin: 16px 0; }
      input[type="text"], button { font-size: 16px; padding: 10px 12px; border-radius: 8px; border: 1px solid #33407a; background: #0f1630; color: #fff; }
      button { cursor: pointer; background: #3b82f6; border-color: #3b82f6; }
      button.secondary { background: #0f1630; }
      .row { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
      .muted { color: #a3b0d4; font-size: 14px; }
      .links a { color: #93c5fd; text-decoration: none; }
      .links a:hover { text-decoration: underline; }
      code { background: #0f1630; padding: 4px 6px; border-radius: 6px; }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Lean Coffee</h1>
      <div class="card">
        <h2>Welcome</h2>
        <p class="muted">Start a Lean Coffee or join one thatâ€™s already running.</p>
        <div class="row" style="margin-top:8px;">
          <button id="startBtn">Start Meeting</button>
          <button id="joinBtn" class="secondary">Join Meeting</button>
        </div>
      </div>
      <p class="muted">Tip: Use the admin screen on your phone to move topics; display the board on a shared screen.</p>
    </div>

    <script>
      const startBtn = document.getElementById('startBtn');
      const joinBtn = document.getElementById('joinBtn');

      function norm(code){ return (code || '').toUpperCase().replace(/[^A-Z0-9]/g,''); }

      startBtn.addEventListener('click', async () => {
        const input = prompt('Enter a meeting code (4-12 letters/numbers):');
        const meetingId = norm(input);
        if (!meetingId || meetingId.length < 4 || meetingId.length > 12) return alert('Invalid code. Use 4-12 letters/numbers.');
        try {
          const res = await fetch('/api/create-with-id', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ meetingId })
          });
          if (!res.ok) {
            const data = await res.json().catch(()=>({}));
            return alert(data.error || 'Failed to create meeting');
          }
          const data = await res.json();
          try { localStorage.setItem(`adminToken:${data.meetingId}`, data.adminToken); } catch {}
          location.href = `/admin/${data.meetingId}`;
        } catch (e) {
          alert('Network error creating meeting');
        }
      });

      joinBtn.addEventListener('click', () => {
        const input = prompt('Enter meeting code to join:');
        const meetingId = norm(input);
        if (!meetingId) return;
        location.href = `/join/${meetingId}`;
      });
    </script>
  </body>
  </html>
